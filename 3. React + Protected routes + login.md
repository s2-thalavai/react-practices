# 3. React + Protected routes + login

This setup uses:

1. React Router  
2. Azure Static Web Apps built-in authentication  
3. Route protection based on user login state  
4. User role access control (e.g., admin)


## **Architecture Overview**

Azure Static Web Apps includes identity providers:

âœ” GitHub  
âœ” Google  
âœ” Microsoft (AAD)  
âœ” Twitter  
âœ” Auth0  
âœ” Facebook

No backend needed â€” SWA injects user identity in:

`/.auth/me` (API endpoint)

We will:

âœ” Fetch login state  
âœ” Store user info  
âœ” Protect pages based on roles


## 1. **Create app**

```bash
npx create-react-app react-swa-auth-demo
cd react-swa-auth-demo
npm install react-router-dom axios
```

----------

## **2. Pages Setup**

### Folder structure

```
src/
 â”œâ”€â”€ pages/
 â”‚    â”œâ”€â”€ Home.js
 â”‚    â”œâ”€â”€ Dashboard.js
 â”‚    â”œâ”€â”€ Admin.js
 â”œâ”€â”€ components/
 â”‚    â”œâ”€â”€ ProtectedRoute.js
 â”œâ”€â”€ AuthContext.js
 â”œâ”€â”€ App.js
 â””â”€â”€ index.js
``` 

----------

## **3. Create Auth Context (store login info)**

 ###`src/AuthContext.js`

```js
import { createContext, useEffect, useState } from "react";
import axios from "axios";

export const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);

  async function loadUser() {
    try {
      const res = await axios.get("/.auth/me");
      const userData = res.data?.clientPrincipal || null;
      setUser(userData);
    } catch {
      setUser(null);
    }
  }

  useEffect(() => {
    loadUser();
  }, []);

  return (
    <AuthContext.Provider value={{ user, refreshUser: loadUser }}>
      {children}
    </AuthContext.Provider>
  );
}

```

----------

----------

# âœ¨ **4ï¸âƒ£ Protected Route Component**

ğŸ“Œ `src/components/ProtectedRoute.js`

```js
import { useContext } from "react";
import { Navigate } from "react-router-dom";
import { AuthContext } from "../AuthContext";

export default function ProtectedRoute({ children, role }) {
  const { user } = useContext(AuthContext);

  if (!user) return <Navigate to="/" />;

  if (role && !user.userRoles.includes(role)) {
    return <h2> Access denied â€” you need {role} role</h2>;
  }

  return children;
}

``` 

âœ” Supports login requirement  
âœ” Supports role-based access

----------

## **5ï¸âƒ£ Page components**

ğŸ“Œ `src/pages/Home.js`

```js
export default function Home() {
  return (
    <div style={{ textAlign: "center", marginTop: 40 }}>
      <h2> Public Home Page</h2>
      <a href="/.auth/login/github">Login with GitHub</a>
      <br />
      <a href="/.auth/logout">Logout</a>
    </div>
  );
}

```

`src/pages/Dashboard.js`

```js
export default function Dashboard() {
  return (
    <div style={{ textAlign: "center", marginTop: 40 }}>
      <h2>User Dashboard</h2>
      <p>Welcome, you are logged in.</p>
    </div>
  );
}

```

## `src/pages/Admin.js`

``` js
export default function Admin() {
  return (
    <div style={{ textAlign: "center", marginTop: 40 }}>
      <h2>Admin Only Page</h2>
      <p>If you can see this, you have admin access.</p>
    </div>
  );
}

```

----------

## **6. App.js with routing and protection**

`src/App.js`

```js
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { AuthProvider } from "./AuthContext";
import ProtectedRoute from "./components/ProtectedRoute";
import Home from "./pages/Home";
import Dashboard from "./pages/Dashboard";
import Admin from "./pages/Admin";

function App() {
  return (
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<Home />} />

          <Route
            path="/dashboard"
            element={
              <ProtectedRoute>
                <Dashboard />
              </ProtectedRoute>
            }
          />

          <Route
            path="/admin"
            element={
              <ProtectedRoute role="admin">
                <Admin />
              </ProtectedRoute>
            }
          />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  );
}

export default App;

```

----------

## **7. Azure Static Web Apps config (auth + routing)**

Create file:

`staticwebapp.config.json` 

Content:

```json
{
  "routes": [
    {
      "route": "/admin",
      "allowedRoles": ["admin"]
    },
    {
      "route": "/dashboard",
      "allowedRoles": ["authenticated"]
    },
    {
      "route": "/*",
      "rewrite": "/index.html"
    }
  ]
}

``` 

âœ” Protects routes even if user hacks front-end  
âœ” Ensures refresh works  
âœ” Secures admin page server-side

----------

## **8. Deploy via Azure SWA + GitHub Actions**

Push to GitHub

Then in Azure portal:

Static Web Apps â†’ Create â†’ Connect GitHub repo â†’  
Choose:

âœ” App location: `/`  
âœ” Output folder: `build`

Azure will auto-deploy

----------

## **9ï¸âƒ£ Assign an admin role**

Azure Portal â†’ Your Static Web App â†’ **Users** â†’ Invite

Enter your email and set role:

`admin` 

After login youâ€™ll have admin access.

----------

## Your app now supports:

âœ” Login  
âœ” Logout  
âœ” Authenticated routing  
âœ” Server-side access control  
âœ” Admin-only pages

-----
